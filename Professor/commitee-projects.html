<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>งานกรรมการ - จัดการการสอบโครงงาน</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        color: #333;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      .header-title {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 0.5rem;
      }

      .header-title h1 {
        color: #2d3748;
        font-size: 2rem;
        font-weight: 700;
      }

      .role-badge {
        background: linear-gradient(135deg, #48bb78, #38a169);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 600;
      }

      .breadcrumb {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #718096;
        font-size: 0.95rem;
      }

      .breadcrumb a {
        color: #4299e1;
        text-decoration: none;
      }

      .controls-section {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      .exam-phase-selector {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
      }

      .exam-phase-btn {
        background: #edf2f7;
        color: #4a5568;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 25px;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .exam-phase-btn:hover:not(.active) {
        background: #d6dbe2;
        transform: translateY(-1px);
      }

      .exam-phase-btn.active {
        background: linear-gradient(45deg, #4299e1, #3182ce);
        color: white;
        box-shadow: 0 4px 15px rgba(66, 153, 225, 0.4);
      }

      .status-filter {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
      }

      .filter-btn {
        background: white;
        color: #4a5568;
        border: 2px solid #e2e8f0;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .filter-btn:hover {
        border-color: #4299e1;
        color: #4299e1;
      }

      .filter-btn.active {
        background: #4299e1;
        color: white;
        border-color: #4299e1;
      }

      .projects-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 2rem;
      }

      .project-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .project-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 5px;
        background: linear-gradient(90deg, #48bb78, #38a169);
      }

      .project-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
      }

      .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-bottom: 1rem;
      }

      .status-pending {
        background: #fef3c7;
        color: #92400e;
      }

      .status-evaluated {
        background: #bfdbfe;
        color: #1e3a8a;
      }

      .status-passed {
        background: #bbf7d0;
        color: #14532d;
      }

      .status-revision {
        background: #fecaca;
        color: #7f1d1d;
      }

      .status-failed {
        background: #e5e7eb;
        color: #1f2937;
      }

      .project-title {
        color: #2d3748;
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 1rem;
        line-height: 1.4;
      }

      .project-meta {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #e2e8f0;
      }

      .meta-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #4a5568;
        font-size: 0.9rem;
      }

      .meta-item i {
        color: #4299e1;
        width: 20px;
      }

      .exam-info {
        background: #eff6ff;
        padding: 1rem;
        border-radius: 10px;
        margin-bottom: 1rem;
        border-left: 4px solid #3b82f6;
      }

      .exam-info-title {
        font-weight: 600;
        color: #1e40af;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .team-members {
        margin-bottom: 1rem;
      }

      .team-members h4 {
        color: #4a5568;
        margin-bottom: 0.5rem;
        font-size: 0.95rem;
      }

      .members-list {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .member-tag {
        background: #e6fffa;
        color: #234e52;
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-size: 0.85rem;
        border: 1px solid #b2f5ea;
      }

      .card-actions {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
      }

      .btn {
        padding: 0.6rem 1.2rem;
        border: none;
        border-radius: 8px;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
      }

      .btn-primary {
        background: linear-gradient(135deg, #4299e1, #3182ce);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(66, 153, 225, 0.3);
      }

      .btn-success {
        background: linear-gradient(135deg, #48bb78, #38a169);
        color: white;
      }

      .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(72, 187, 120, 0.3);
      }

      .btn-cancel {
        background: #e5e7eb;
        color: #374151;
      }

      .btn-cancel:hover {
        background: #d1d5db;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.6);
      }

      .modal-content {
        background-color: #fefefe;
        margin: 2% auto;
        padding: 30px;
        border-radius: 15px;
        width: 90%;
        max-width: 900px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        position: relative;
        animation: slideIn 0.3s ease-out;
        max-height: 90vh;
        overflow-y: auto;
      }

      @keyframes slideIn {
        from {
          transform: translateY(-50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .close-btn {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.3s;
      }

      .close-btn:hover {
        color: #333;
      }

      .modal-title {
        color: #2d3748;
        font-size: 1.8rem;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #e2e8f0;
      }

      .modal-section {
        margin-bottom: 2rem;
      }

      .section-title {
        color: #4299e1;
        font-size: 1.3rem;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        background: #f7fafc;
        padding: 1rem;
        border-radius: 10px;
        margin-bottom: 1rem;
      }

      .info-item {
        display: flex;
        flex-direction: column;
      }

      .info-label {
        font-size: 0.85rem;
        color: #718096;
        margin-bottom: 0.25rem;
      }

      .info-value {
        font-weight: 600;
        color: #2d3748;
      }

      .document-links {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      .doc-link {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 1rem;
        background: #f0f9ff;
        border-radius: 8px;
        color: #1e40af;
        text-decoration: none;
        transition: all 0.3s ease;
        border: 1px solid #bfdbfe;
      }

      .doc-link:hover {
        background: #dbeafe;
        transform: translateX(5px);
      }

      .doc-link i {
        font-size: 1.5rem;
      }

      .evaluation-form {
        background: #f7fafc;
        padding: 1.5rem;
        border-radius: 10px;
        margin-top: 1rem;
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-label {
        display: block;
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 0.5rem;
      }

      textarea {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
        min-height: 120px;
        resize: vertical;
        font-family: inherit;
      }

      textarea:focus {
        outline: none;
        border-color: #4299e1;
        box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
      }

      .radio-group {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      .radio-option {
        display: flex;
        align-items: center;
        padding: 1rem;
        background: white;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .radio-option:hover {
        border-color: #4299e1;
        background: #f0f9ff;
      }

      .radio-option input[type="radio"] {
        margin-right: 0.75rem;
        transform: scale(1.2);
        cursor: pointer;
      }

      .radio-option.selected {
        border-color: #4299e1;
        background: #dbeafe;
      }

      .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        padding-top: 1.5rem;
        border-top: 1px solid #e2e8f0;
        margin-top: 2rem;
      }

      .signature-section {
        background: #f0fdf4;
        padding: 1.5rem;
        border-radius: 10px;
        border: 2px dashed #86efac;
        margin-top: 1rem;
      }

      .signature-list,
      .committee-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
      }

      .signature-item,
      .committee-item {
        background: white;
        padding: 1rem;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }

      .signature-name,
      .committee-name {
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 0.25rem;
      }

      .signature-role,
      .committee-role {
        font-size: 0.85rem;
        color: #718096;
        margin-bottom: 0.5rem;
      }

      .signature-status {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        font-weight: 600;
      }

      .signature-status.signed {
        background: #bbf7d0;
        color: #14532d;
      }

      .signature-status.pending {
        background: #fecaca;
        color: #7f1d1d;
      }

      .alert-info {
        background: #dbeafe;
        border: 1px solid #93c5fd;
        color: #1e40af;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .revision-section {
        background: #fef3c7;
        padding: 1.5rem;
        border-radius: 10px;
        border-left: 4px solid #f59e0b;
        margin-bottom: 1.5rem;
      }

      .revision-section h4 {
        color: #92400e;
        margin-bottom: 0.75rem;
        font-size: 1.1rem;
      }

      @media (max-width: 768px) {
        .projects-grid {
          grid-template-columns: 1fr;
        }

        .modal-content {
          width: 95%;
          margin: 5% auto;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="breadcrumb">
          <a href="teacher_main_dashboard.html"
            ><i class="fas fa-home"></i> Dashboard</a
          >
          <i class="fas fa-chevron-right"></i>
          <span>งานกรรมการ</span>
        </div>
        <div class="header-title">
          <h1><i class="fas fa-gavel"></i> จัดการการสอบโครงงาน</h1>
          <div class="role-badge">กรรมการสอบ</div>
        </div>
      </div>

      <div class="controls-section">
        <div class="exam-phase-selector">
          <button class="exam-phase-btn active" data-phase="proposal">
            <i class="fas fa-file-alt"></i> การสอบหัวข้อโครงงาน
          </button>
          <button class="exam-phase-btn" data-phase="final">
            <i class="fas fa-graduation-cap"></i> การสอบจบโครงงาน
          </button>
        </div>

        <div class="status-filter">
          <button class="filter-btn active" data-status="all">ทั้งหมด</button>
          <button class="filter-btn" data-status="pending">รอประเมินผล</button>
          <button class="filter-btn" data-status="revision">รอการแก้ไข</button>
          <button class="filter-btn" data-status="awaiting_signature">
            รอลงนาม
          </button>
          <button class="filter-btn" data-status="passed">ผ่าน</button>
          <button class="filter-btn" data-status="failed">ไม่ผ่าน</button>
        </div>
      </div>

      <div class="projects-grid" id="projectsGrid"></div>
    </div>

    <div id="projectModal" class="modal">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h2 class="modal-title" id="modalTitle"></h2>
        <div id="modalBody"></div>
        <div class="modal-footer" id="modalFooter"></div>
      </div>
    </div>

    <script>
      const projectsData = {
        proposal: [
          {
            id: "p0",
            title: "ระบบจัดการคลังสินค้าอัจฉริยะด้วยเทคโนโลยี IoT",
            students: ["นายธนบูลย์ อิ่มเจริญ", "นายวัชโรทัย เลิศวิลัย"],
            advisor: "ผศ. สมชัย เชียงพงศ์พันธุ์",
            coAdvisor: "ผศ.ดร.สุปีติ กุลจันทร์",
            examDate: "12 พ.ย. 2568",
            examTime: "14:00 น.",
            location: "ห้องประชุม 201",
            status: "pending",
            proposalDoc: "#",
            projectType: "โครงงานพิเศษ",
            major: "เทคโนโลยีสารสนเทศ (IT)",
            submittedDate: "15 พฤศจิกายน 2568",
            description:
              "พัฒนาระบบจัดการคลังสินค้าอัจฉริยะที่ใช้เทคโนโลยี Internet of Things (IoT) ในการตรวจสอบและจัดการสต๊อกสินค้าแบบเรียลไทม์ มีระบบแจ้งเตือนอัตโนมัติเมื่อสินค้าใกล้หมด และสามารถติดตามการเคลื่อนไหวของสินค้าในคลังได้",
            committee: [
              "รศ.ดร.อนิราช มิ่งขวัญ",
              "ผศ. สมชัย เชียงพงศ์พันธุ์",
              "ผศ.ดร.นิติการ นาคเจือทอง",
              "อ.ดร.วัชรชัย คงศิริวัฒนา",
            ],
            examType: "การสอบหัวข้อโครงงาน",
          },
          {
            id: "p1",
            title: "ระบบจัดการร้านค้าออนไลน์ด้วย React และ Node.js",
            students: ["นายสมศักดิ์ เก่งมาก", "นางสาวมาลี สุขใส"],
            advisor: "ผศ.พีระศักดิ์ เสรีกุล",
            examDate: "15 พ.ย. 2568",
            examTime: "09:00 น.",
            location: "ห้องประชุม 301",
            status: "pending",
            proposalDoc: "#",
            projectType: "โครงงานพิเศษ",
            description:
              "พัฒนาระบบจัดการร้านค้าออนไลน์ที่มีฟีเจอร์ครบครัน รองรับการจัดการสินค้า คำสั่งซื้อ และระบบชำระเงิน",
            committee: [
              "รศ.ดร.อนิราช มิ่งขวัญ",
              "ผศ.พีระศักดิ์ เสรีกุล",
              "ผศ.นิมิต ศรีคำทา",
              "อ.ดร.พิทย์พิมล ชูรอด",
            ],
            examType: "การสอบหัวข้อโครงงาน",
          },
          {
            id: "p2",
            title: "แอปพลิเคชันจัดการสต๊อกสินค้าอัตโนมัติ",
            students: ["วิรัช ทำดี", "ปรีชา เก่ง", "สุดา ขยัน"],
            advisor: "ผศ.อรบุษป์ วุฒิกมลชัย",
            examDate: "18 พ.ย. 2568",
            examTime: "13:00 น.",
            location: "ห้องประชุม 305",
            status: "revision",
            proposalDoc: "#",
            projectType: "โครงงานพิเศษ",
            evaluationResult: "revision",
            evaluationNotes:
              "กรุณาปรับปรุงส่วนของ Use Case Diagram และเพิ่มรายละเอียดของ AI Algorithm",
            description:
              "ระบบจัดการสต๊อกสินค้าแบบอัตโนมัติด้วย AI ที่สามารถพยากรณ์ความต้องการสินค้า",
            revisionDoc: "#",
            committee: [
              "ผศ.อรบุษป์ วุฒิกมลชัย",
              "ผศ.ดร.บีสุดา ดาวเรือง",
              "อ.ดร.กาญจน ณ ศรีธะ",
              "ผศ.ดร.ศรายุทธ ธเนศสกุลวัฒนา",
            ],
            examType: "การสอบหัวข้อโครงงาน",
          },
          {
            id: "p3",
            title: "ระบบวิเคราะห์ข้อมูลการขายด้วย Machine Learning",
            students: ["นายธนวัฒน์ สมบูรณ์", "นางสาวอรุณี ใจดี"],
            advisor: "ผศ.ดร.วันทนี ประจวบศุภกิจ",
            examDate: "20 พ.ย. 2568",
            examTime: "10:30 น.",
            location: "ห้องประชุม 204",
            status: "passed",
            proposalDoc: "#",
            projectType: "โครงงานพิเศษ",
            evaluationResult: "passed",
            evaluationNotes:
              "โครงงานมีความน่าสนใจและมีความเป็นไปได้สูง แนะนำให้เพิ่มการทดสอบกับข้อมูลจริง",
            description:
              "ระบบวิเคราะห์และพยากรณ์ข้อมูลการขายด้วยเทคนิค Machine Learning",
            committee: [
              "ผศ.ดร.วันทนี ประจวบศุภกิจ",
              "ผศ.ดร.สุปีติ กุลจันทร์",
              "อ.ดร.พิทย์พิมล ชูรอด",
              "ผศ.ดร.พาฝัน ดวงไพศาล",
            ],
            examType: "การสอบหัวข้อโครงงาน",
          },
        ],
        final: [
          {
            id: "f1",
            title: "ระบบแนะนำหนังสือด้วย Machine Learning",
            students: ["กิตติ เก่งมาก", "นิดา เท่ง"],
            advisor: "ผศ.ดร.บีสุดา ดาวเรือง",
            examDate: "10 ต.ค. 2568",
            examTime: "13:00 น.",
            location: "ห้องประชุม 401",
            status: "pending",
            reportDoc: "#",
            presentationDoc: "#",
            projectType: "โครงงานสหกิจ",
            description:
              "ระบบแนะนำหนังสือที่ใช้เทคนิค Collaborative Filtering และ Content-based Filtering",
            committee: [
              {
                name: "รศ.ดร.อนิราช มิ่งขวัญ",
                role: "ประธานกรรมการ",
                signed: false,
              },
              { name: "ผศ.ดร.บีสุดา ดาวเรือง", role: "กรรมการ", signed: false },
              { name: "อ.ดร.กาญจน ณ ศรีธะ", role: "กรรมการ", signed: false },
              {
                name: "ผศ.ดร.นิติการ นาคเจือทอง",
                role: "กรรมการ",
                signed: false,
              },
            ],
            examType: "การสอบจบโครงงาน",
          },
          {
            id: "f2",
            title: "เว็บแอปพลิเคชันจัดการคลินิกสัตว์",
            students: ["สมใส ใสใจ", "วีระ รู้ดี"],
            advisor: "ผศ.ดร.ขนิษฐา นามี",
            examDate: "25 ต.ค. 2568",
            examTime: "10:00 น.",
            location: "ห้องประชุม 502",
            status: "revision",
            reportDoc: "#",
            presentationDoc: "#",
            projectType: "โครงงานพิเศษ",
            evaluationResult: "revision",
            evaluationNotes:
              "โครงงานดีมาก แต่ต้องแก้ไขเล่มโครงงานในส่วน Chapter 5 และปรับปรุง UI/UX ของระบบให้สมบูรณ์ขึ้น",
            description:
              "ระบบจัดการคลินิกสัตว์ครบวงจร รองรับการนัดหมาย ประวัติการรักษา และระบบคลังยา",
            revisionReportDoc: "#",
            committee: [
              {
                name: "ผศ.นิมิต ศรีคำทา",
                role: "ประธานกรรมการ",
                signed: false,
              },
              { name: "ผศ.ดร.ขนิษฐา นามี", role: "กรรมการ", signed: false },
              { name: "อ.ดร.พิทย์พิมล ชูรอด", role: "กรรมการ", signed: false },
              { name: "ผศ.สิวาลัย จินเจือ", role: "กรรมการ", signed: false },
            ],
            examType: "การสอบจบโครงงาน",
          },
          {
            id: "f3",
            title: "ระบบวิเคราะห์ข้อมูลธุรกิจด้วย AI",
            students: [
              "นายธนวัฒน์ สมบูรณ์",
              "นางสาวอรุณี ใจดี",
              "นายธีรภัทร เก่งจริง",
            ],
            advisor: "ผศ.ดร.วันทนี ประจวบศุภกิจ",
            examDate: "28 ต.ค. 2568",
            examTime: "14:00 น.",
            location: "ห้องประชุม 302",
            status: "awaiting_signature",
            reportDoc: "#",
            presentationDoc: "#",
            projectType: "โครงงานพิเศษ",
            evaluationResult: "passed",
            evaluationNotes: "โครงงานผ่านการสอบเรียบร้อย มีคุณภาพดีมาก",
            description:
              "ระบบวิเคราะห์และพยากรณ์ข้อมูลธุรกิจด้วย Deep Learning",
            committee: [
              {
                name: "รศ.ดร.ยุพิน สรรพคุณ",
                role: "ประธานกรรมการ",
                signed: true,
              },
              {
                name: "ผศ.ดร.วันทนี ประจวบศุภกิจ",
                role: "กรรมการ",
                signed: true,
              },
              {
                name: "ผศ.ดร.สุปีติ กุลจันทร์",
                role: "กรรมการ",
                signed: false,
              },
              { name: "อ.ดร.ศิรินทรา แว่วศรี", role: "กรรมการ", signed: false },
            ],
            examType: "การสอบจบโครงงาน",
          },
          {
            id: "f4",
            title: "แอปพลิเคชันจัดการการเรียนรู้ออนไลน์ด้วย Adaptive Learning",
            students: ["นายพัฒนา เรียนดี", "นางสาวสุดารัตน์ ขยันขันแข็ง"],
            advisor: "ผศ.ดร.พาฝัน ดวงไพศาล",
            examDate: "15 ก.ย. 2568",
            examTime: "09:30 น.",
            location: "ห้องประชุม 203",
            status: "passed",
            reportDoc: "#",
            presentationDoc: "#",
            projectType: "โครงงานพิเศษ",
            evaluationResult: "passed",
            evaluationNotes:
              "โครงงานมีคุณภาพดีเยี่ยม การออกแบบและพัฒนาระบบมีความสมบูรณ์ ผ่านการสอบจบเรียบร้อย",
            description:
              "พัฒนาแอปพลิเคชันการเรียนรู้ออนไลน์ที่ปรับเนื้อหาตามความสามารถของผู้เรียนแต่ละคน ใช้เทคนิค Machine Learning ในการวิเคราะห์พฤติกรรมการเรียนรู้",
            committee: [
              {
                name: "รศ.ดร.อนิราช มิ่งขวัญ",
                role: "ประธานกรรมการ",
                signed: true,
              },
              {
                name: "ผศ.ดร.พาฝัน ดวงไพศาล",
                role: "กรรมการ",
                signed: true,
              },
              {
                name: "ผศ.ดร.สุพาภรณ์ ซิ้มเจริญ",
                role: "กรรมการ",
                signed: true,
              },
              {
                name: "อ.ดร.ประดิษฐ์ พิทักษ์เสถียรกุล",
                role: "กรรมการ",
                signed: true,
              },
            ],
            examType: "การสอบจบโครงงาน",
          },
          {
            id: "f5",
            title: "ระบบตรวจจับและวิเคราะห์อารมณ์จากใบหน้าด้วย Deep Learning",
            students: ["นายวิศรุต ฉลาดเฉลียว", "นางสาวณัฐกานต์ ปัญญาดี"],
            advisor: "อ.ดร.ศิรินทรา แว่วศรี",
            examDate: "22 ก.ย. 2568",
            examTime: "13:30 น.",
            location: "ห้องประชุม 401",
            status: "passed",
            reportDoc: "#",
            presentationDoc: "#",
            projectType: "โครงงานพิเศษ",
            evaluationResult: "passed",
            evaluationNotes:
              "งานวิจัยมีคุณภาพดีมาก มีการทดสอบและวิเคราะห์ผลที่ครบถ้วน ผลงานสามารถนำไปใช้ประโยชน์ได้จริง",
            description:
              "พัฒนาระบบตรวจจับและวิเคราะห์อารมณ์จากใบหน้าแบบเรียลไทม์ด้วยเทคนิค Deep Learning และ Computer Vision สามารถระบุอารมณ์ได้ 7 ประเภท",
            committee: [
              {
                name: "ผศ.ดร.บีสุดา ดาวเรือง",
                role: "ประธานกรรมการ",
                signed: true,
              },
              {
                name: "อ.ดร.ศิรินทรา แว่วศรี",
                role: "กรรมการ",
                signed: true,
              },
              {
                name: "ผศ.ดร.นัฎฐพันธ์ นาคพงษ์",
                role: "กรรมการ",
                signed: true,
              },
              {
                name: "อ.ดร.วัชรชัย คงศิริวัฒนา",
                role: "กรรมการ",
                signed: true,
              },
            ],
            examType: "การสอบจบโครงงาน",
          },
        ],
      };

      let currentPhase = "proposal";
      let currentStatusFilter = "all";
      let currentProject = null;

      function init() {
        renderProjects(currentPhase, currentStatusFilter);
        setupPhaseButtons();
        setupFilterButtons();
      }

      function setupPhaseButtons() {
        document.querySelectorAll(".exam-phase-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            document
              .querySelectorAll(".exam-phase-btn")
              .forEach((b) => b.classList.remove("active"));
            this.classList.add("active");
            currentPhase = this.dataset.phase;
            renderProjects(currentPhase, currentStatusFilter);
          });
        });
      }

      function setupFilterButtons() {
        document.querySelectorAll(".filter-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            document
              .querySelectorAll(".filter-btn")
              .forEach((b) => b.classList.remove("active"));
            this.classList.add("active");
            currentStatusFilter = this.dataset.status;
            renderProjects(currentPhase, currentStatusFilter);
          });
        });
      }

      function renderProjects(phase, statusFilter) {
        const grid = document.getElementById("projectsGrid");
        let projects = projectsData[phase];

        if (statusFilter !== "all") {
          projects = projects.filter((p) => p.status === statusFilter);
        }

        if (projects.length === 0) {
          grid.innerHTML =
            '<div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #718096;"><i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem;"></i><p style="font-size: 1.2rem;">ไม่มีโครงงานในสถานะนี้</p></div>';
          return;
        }

        grid.innerHTML = projects
          .map(
            (project) => `
            <div class="project-card" data-project-id="${project.id}">
                ${getStatusBadge(project.status, phase)}
                
                ${
                  project.examType
                    ? `
                    <div style="margin-bottom: 0.75rem;">
                        <span style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 0.35rem 0.85rem; border-radius: 15px; font-size: 0.8rem; font-weight: 600;">
                            <i class="fas fa-certificate"></i> ${project.examType}
                        </span>
                    </div>
                `
                    : ""
                }
                
                <h3 class="project-title">${project.title}</h3>
                
                <div class="project-meta">
                    <div class="meta-item">
                        <i class="fas fa-user-tie"></i>
                        <span>ที่ปรึกษา: ${project.advisor}</span>
                    </div>
                    ${
                      project.coAdvisor
                        ? `
                        <div class="meta-item">
                            <i class="fas fa-user-friends"></i>
                            <span>${project.coAdvisor}</span>
                        </div>
                    `
                        : ""
                    }
                </div>
                
                <div class="exam-info">
                    <div class="exam-info-title">
                        <i class="fas fa-calendar-check"></i>
                        ข้อมูลการสอบ
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-clock"></i>
                        <span>${project.examDate} เวลา ${
              project.examTime
            }</span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>${project.location}</span>
                    </div>
                </div>
                
                <div class="team-members">
                    <h4>สมาชิกทีม (${project.students.length} คน)</h4>
                    <div class="members-list">
                        ${project.students
                          .map((s) => `<span class="member-tag">${s}</span>`)
                          .join("")}
                    </div>
                </div>
                
                <div class="card-actions">
                    <button class="btn btn-primary" onclick="openProjectModal('${
                      project.id
                    }', '${phase}')">
                        <i class="fas fa-eye"></i>
                        ดูรายละเอียดและประเมิน
                    </button>
                </div>
            </div>
        `
          )
          .join("");
      }

      function getStatusBadge(status, phase) {
        const badges = {
          pending:
            '<div class="status-badge status-pending"><i class="fas fa-clock"></i> รอประเมินผล</div>',
          revision:
            '<div class="status-badge status-revision"><i class="fas fa-pencil-alt"></i> รอการแก้ไข</div>',
          passed:
            '<div class="status-badge status-passed"><i class="fas fa-check-circle"></i> ผ่าน</div>',
          failed:
            '<div class="status-badge status-failed"><i class="fas fa-times-circle"></i> ไม่ผ่าน</div>',
          awaiting_signature:
            '<div class="status-badge status-evaluated"><i class="fas fa-file-signature"></i> รอลงนาม</div>',
        };
        return badges[status] || badges.pending;
      }

      function openProjectModal(projectId, phase) {
        const project = projectsData[phase].find((p) => p.id === projectId);
        if (!project) return;

        currentProject = { ...project, phase };

        const modal = document.getElementById("projectModal");
        document.getElementById("modalTitle").textContent = project.title;

        let modalBody = `
            <div class="modal-section">
                <div class="section-title">
                    <i class="fas fa-info-circle"></i>
                    ข้อมูลโครงงาน
                </div>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">อาจารย์ที่ปรึกษา</span>
                        <span class="info-value">${project.advisor}</span>
                    </div>
                    ${
                      project.coAdvisor
                        ? `
                        <div class="info-item">
                            <span class="info-label">อาจารย์ที่ปรึกษาร่วม</span>
                            <span class="info-value">${project.coAdvisor}</span>
                        </div>
                    `
                        : ""
                    }
                    ${
                      project.projectType
                        ? `
                        <div class="info-item">
                            <span class="info-label">ประเภทโครงงาน</span>
                            <span class="info-value">${project.projectType}</span>
                        </div>
                    `
                        : ""
                    }
                    ${
                      project.major
                        ? `
                        <div class="info-item">
                            <span class="info-label">สาขาวิชา</span>
                            <span class="info-value">${project.major}</span>
                        </div>
                    `
                        : ""
                    }
                    <div class="info-item">
                        <span class="info-label">วันที่สอบ</span>
                        <span class="info-value">${project.examDate}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">เวลา</span>
                        <span class="info-value">${project.examTime}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">สถานที่</span>
                        <span class="info-value">${project.location}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">สมาชิก</span>
                        <span class="info-value">${
                          project.students.length
                        } คน</span>
                    </div>
                    ${
                      project.submittedDate
                        ? `
                        <div class="info-item">
                            <span class="info-label">วันที่ส่ง</span>
                            <span class="info-value">${project.submittedDate}</span>
                        </div>
                    `
                        : ""
                    }
                </div>
                <div style="margin-top: 1rem;">
                    <strong>สมาชิกทีม:</strong>
                    <div class="members-list" style="margin-top: 0.5rem;">
                        ${project.students
                          .map((s) => `<span class="member-tag">${s}</span>`)
                          .join("")}
                    </div>
                </div>
                <div style="margin-top: 1rem;">
                    <strong>รายละเอียดโครงงาน:</strong>
                    <p style="margin-top: 0.5rem; color: #4a5568;">${
                      project.description
                    }</p>
                </div>
            </div>
        `;

        // แสดงคณะกรรมการ
        if (
          project.status !== "awaiting_signature" &&
          project.status !== "passed"
        ) {
          if (phase === "proposal" && project.committee) {
            const roles = ["ประธานกรรมการ", "กรรมการ", "กรรมการ", "กรรมการ"];
            modalBody += `
                    <div class="modal-section">
                        <div class="section-title">
                            <i class="fas fa-users"></i>
                            คณะกรรมการสอบ
                        </div>
                        <div class="committee-list">
                            ${project.committee
                              .map(
                                (name, index) => `
                                <div class="committee-item">
                                    <div class="committee-name">${name}</div>
                                    <div class="committee-role">${
                                      roles[index] || "กรรมการ"
                                    }</div>
                                </div>
                            `
                              )
                              .join("")}
                        </div>
                    </div>
                `;
          } else if (phase === "final" && project.committee) {
            modalBody += `
                    <div class="modal-section">
                        <div class="section-title">
                            <i class="fas fa-users"></i>
                            คณะกรรมการสอบ
                        </div>
                        <div class="committee-list">
                            ${project.committee
                              .map(
                                (member) => `
                                <div class="committee-item">
                                    <div class="committee-name">${member.name}</div>
                                    <div class="committee-role">${member.role}</div>
                                </div>
                            `
                              )
                              .join("")}
                        </div>
                    </div>
                `;
          }
        }

        // เอกสารที่เกี่ยวข้อง
        if (phase === "proposal") {
          if (project.status === "revision" && project.revisionDoc) {
            modalBody += `
                    <div class="modal-section">
                        <div class="revision-section">
                            <h4><i class="fas fa-exclamation-triangle"></i> ข้อเสนอแนะที่ต้องแก้ไข</h4>
                            <p style="margin-top: 0.5rem; color: #92400e; white-space: pre-wrap;">${project.evaluationNotes}</p>
                        </div>
                        <div class="section-title">
                            <i class="fas fa-file-alt"></i>
                            เอกสารที่นักศึกษาส่งมาใหม่
                        </div>
                        <div class="document-links">
                            <a href="${project.revisionDoc}" target="_blank" class="doc-link">
                                <i class="fas fa-file-pdf"></i>
                                <div>
                                    <div style="font-weight: 600;">เอกสารเสนอหัวข้อที่แก้ไขแล้ว (ฉบับใหม่)</div>
                                    <div style="font-size: 0.85rem; color: #64748b;">ดาวน์โหลด PDF</div>
                                </div>
                            </a>
                            <a href="${project.proposalDoc}" target="_blank" class="doc-link" style="opacity: 0.6;">
                                <i class="fas fa-file-pdf"></i>
                                <div>
                                    <div style="font-weight: 600;">เอกสารเสนอหัวข้อ (ฉบับเดิม)</div>
                                    <div style="font-size: 0.85rem; color: #64748b;">เพื่อเปรียบเทียบ</div>
                                </div>
                            </a>
                        </div>
                    </div>
                `;
          } else {
            modalBody += `
                    <div class="modal-section">
                        <div class="section-title">
                            <i class="fas fa-file-alt"></i>
                            เอกสารเสนอหัวข้อ
                        </div>
                        <div class="document-links">
                            <a href="${project.proposalDoc}" target="_blank" class="doc-link">
                                <i class="fas fa-file-pdf"></i>
                                <div>
                                    <div style="font-weight: 600;">เอกสารเสนอหัวข้อโครงงาน</div>
                                    <div style="font-size: 0.85rem; color: #64748b;">ดาวน์โหลด PDF</div>
                                </div>
                            </a>
                        </div>
                    </div>
                `;
          }
        } else if (phase === "final") {
          if (project.status === "revision" && project.revisionReportDoc) {
            modalBody += `
                    <div class="modal-section">
                        <div class="revision-section">
                            <h4><i class="fas fa-exclamation-triangle"></i> ข้อเสนอแนะที่ต้องแก้ไข</h4>
                            <p style="margin-top: 0.5rem; color: #92400e; white-space: pre-wrap;">${project.evaluationNotes}</p>
                        </div>
                        <div class="section-title">
                            <i class="fas fa-file-alt"></i>
                            เอกสารที่นักศึกษาส่งมาใหม่
                        </div>
                        <div class="document-links">
                            <a href="${project.revisionReportDoc}" target="_blank" class="doc-link">
                                <i class="fas fa-book"></i>
                                <div>
                                    <div style="font-weight: 600;">เล่มโครงงานที่แก้ไขแล้ว (ฉบับใหม่)</div>
                                    <div style="font-size: 0.85rem; color: #64748b;">ดาวน์โหลด PDF</div>
                                </div>
                            </a>
                            <a href="${project.reportDoc}" target="_blank" class="doc-link" style="opacity: 0.6;">
                                <i class="fas fa-book"></i>
                                <div>
                                    <div style="font-weight: 600;">เล่มโครงงาน (ฉบับเดิม)</div>
                                    <div style="font-size: 0.85rem; color: #64748b;">เพื่อเปรียบเทียบ</div>
                                </div>
                            </a>
                            <a href="${project.presentationDoc}" target="_blank" class="doc-link">
                                <i class="fas fa-file-powerpoint"></i>
                                <div>
                                    <div style="font-weight: 600;">สไลด์นำเสนอ</div>
                                    <div style="font-size: 0.85rem; color: #64748b;">ดาวน์โหลด PowerPoint</div>
                                </div>
                            </a>
                        </div>
                    </div>
                `;
          } else {
            modalBody += `
                    <div class="modal-section">
                        <div class="section-title">
                            <i class="fas fa-file-alt"></i>
                            เอกสารโครงงาน
                        </div>
                        <div class="document-links">
                            <a href="${project.reportDoc}" target="_blank" class="doc-link">
                                <i class="fas fa-book"></i>
                                <div>
                                    <div style="font-weight: 600;">เล่มโครงงานฉบับสมบูรณ์</div>
                                    <div style="font-size: 0.85rem; color: #64748b;">ดาวน์โหลด PDF</div>
                                </div>
                            </a>
                            <a href="${project.presentationDoc}" target="_blank" class="doc-link">
                                <i class="fas fa-file-powerpoint"></i>
                                <div>
                                    <div style="font-weight: 600;">สไลด์นำเสนอ</div>
                                    <div style="font-size: 0.85rem; color: #64748b;">ดาวน์โหลด PowerPoint</div>
                                </div>
                            </a>
                        </div>
                    </div>
                `;
          }
        }

        // แสดงผลการประเมินที่มีอยู่แล้ว
        if (
          project.evaluationResult &&
          project.status !== "revision" &&
          project.status !== "awaiting_signature"
        ) {
          const resultText = {
            passed: "ผ่าน",
            revision: "ผ่านแบบแก้ไข",
            re_exam: "สอบใหม่",
            failed: "ไม่ผ่าน",
          };

          modalBody += `
                <div class="modal-section">
                    <div class="alert-info">
                        <i class="fas fa-info-circle"></i>
                        <span>คุณได้ประเมินโครงงานนี้แล้ว: <strong>${
                          resultText[project.evaluationResult]
                        }</strong></span>
                    </div>
                    ${
                      project.evaluationNotes
                        ? `
                        <div style="background: #f7fafc; padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                            <strong>ความเห็นและข้อเสนอแนะ:</strong>
                            <p style="margin-top: 0.5rem; color: #4a5568; white-space: pre-wrap;">${project.evaluationNotes}</p>
                        </div>
                    `
                        : ""
                    }
                </div>
            `;
        }

        // ฟอร์มประเมิน
        if (project.status === "pending") {
          modalBody += `
                <div class="modal-section">
                    <div class="section-title">
                        <i class="fas fa-clipboard-check"></i>
                        ประเมินผลการสอบ
                    </div>
                    <div class="evaluation-form">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-comment-dots"></i> ความเห็นและข้อเสนอแนะ
                            </label>
                            <textarea id="evaluationNotes" placeholder="ระบุความเห็น ข้อเสนอแนะ หรือข้อแก้ไขที่ต้องการ...">${
                              project.evaluationNotes || ""
                            }</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-check-circle"></i> ผลการประเมิน
                            </label>
                            <div class="radio-group" id="evaluationOptions">
                                <label class="radio-option" data-value="passed">
                                    <input type="radio" name="evaluation" value="passed">
                                    <div>
                                        <strong>ผ่าน</strong>
                                        <div style="font-size: 0.85rem; color: #64748b;">โครงงานผ่านการประเมิน</div>
                                    </div>
                                </label>
                                <label class="radio-option" data-value="revision">
                                    <input type="radio" name="evaluation" value="revision">
                                    <div>
                                        <strong>ผ่านแบบแก้ไข</strong>
                                        <div style="font-size: 0.85rem; color: #64748b;">ต้องแก้ไขตามข้อเสนอแนะ</div>
                                    </div>
                                </label>
                                <label class="radio-option" data-value="re_exam">
                                    <input type="radio" name="evaluation" value="re_exam">
                                    <div>
                                        <strong>สอบใหม่</strong>
                                        <div style="font-size: 0.85rem; color: #64748b;">ต้องสอบใหม่อีกครั้ง</div>
                                    </div>
                                </label>
                                <label class="radio-option" data-value="failed">
                                    <input type="radio" name="evaluation" value="failed">
                                    <div>
                                        <strong>ไม่ผ่าน</strong>
                                        <div style="font-size: 0.85rem; color: #64748b;">โครงงานไม่ผ่านการประเมิน</div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        } else if (project.status === "revision") {
          modalBody += `
                <div class="modal-section">
                    <div class="section-title">
                        <i class="fas fa-clipboard-check"></i>
                        ประเมินผลการแก้ไข
                    </div>
                    <div class="evaluation-form">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-comment-dots"></i> ความเห็นเพิ่มเติม (ถ้ามี)
                            </label>
                            <textarea id="evaluationNotes" placeholder="ระบุความเห็นเพิ่มเติม...">${
                              project.evaluationNotes || ""
                            }</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-check-circle"></i> ผลการประเมินการแก้ไข
                            </label>
                            <div class="radio-group" id="evaluationOptions">
                                <label class="radio-option" data-value="passed">
                                    <input type="radio" name="evaluation" value="passed">
                                    <div>
                                        <strong>ผ่าน - แก้ไขถูกต้องแล้ว</strong>
                                        <div style="font-size: 0.85rem; color: #64748b;">การแก้ไขตรงตามข้อเสนอแนะ</div>
                                    </div>
                                </label>
                                <label class="radio-option" data-value="failed">
                                    <input type="radio" name="evaluation" value="failed">
                                    <div>
                                        <strong>ไม่ผ่าน - ยังแก้ไขไม่ถูกต้อง</strong>
                                        <div style="font-size: 0.85rem; color: #64748b;">ต้องแก้ไขใหม่อีกครั้ง</div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ฟอร์มลงนามสำหรับโครงงานสอบจบที่ผ่านแล้ว
        if (phase === "final" && project.status === "awaiting_signature") {
          const mySignature = project.committee.find((m) => !m.signed);

          modalBody += `
                <div class="modal-section">
                    <div class="section-title">
                        <i class="fas fa-users"></i>
                        คณะกรรมการสอบ - สถานะการลงนาม
                    </div>
                    <div class="signature-list">
                        ${project.committee
                          .map(
                            (member) => `
                            <div class="signature-item">
                                <div class="signature-name">${member.name}</div>
                                <div class="signature-role">${member.role}</div>
                                <span class="signature-status ${
                                  member.signed ? "signed" : "pending"
                                }">
                                    ${
                                      member.signed
                                        ? "✓ ลงนามแล้ว"
                                        : "⏳ รอลงนาม"
                                    }
                                </span>
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                </div>
                
                <div class="modal-section">
                    <div class="signature-section">
                        <div class="section-title" style="color: #15803d;">
                            <i class="fas fa-signature"></i>
                            ลงนามรับรองผลการสอบ
                        </div>
                        <p style="color: #15803d; margin-top: 0.5rem;">
                            โครงงานนี้ผ่านการสอบเรียบร้อยแล้ว กรุณาลงนามเพื่อรับรองผลการสอบ
                        </p>
                        ${
                          !mySignature
                            ? `
                            <div class="alert-info" style="margin-top: 1rem; background: #d1fae5; border-color: #86efac; color: #15803d;">
                                <i class="fas fa-check-circle"></i>
                                <span>คุณได้ลงนามรับรองแล้ว</span>
                            </div>
                        `
                            : ""
                        }
                    </div>
                </div>
            `;
        }

        // แสดงผลการประเมินสำหรับโครงงานที่ผ่านแล้ว (สอบจบ)
        if (phase === "final" && project.status === "passed") {
          modalBody += `
                <div class="modal-section">
                    <div class="section-title">
                        <i class="fas fa-users"></i>
                        คณะกรรมการสอบ - สถานะการลงนาม
                    </div>
                    <div class="signature-list">
                        ${project.committee
                          .map(
                            (member) => `
                            <div class="signature-item">
                                <div class="signature-name">${member.name}</div>
                                <div class="signature-role">${member.role}</div>
                                <span class="signature-status signed">
                                    ✓ ลงนามแล้ว
                                </span>
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                    <div class="alert-info" style="margin-top: 1rem; background: #d1fae5; border-color: #86efac; color: #15803d;">
                        <i class="fas fa-check-double"></i>
                        <span><strong>โครงงานเสร็จสมบูรณ์</strong> - กรรมการทุกท่านได้ลงนามรับรองแล้ว</span>
                    </div>
                </div>
            `;
        }

        document.getElementById("modalBody").innerHTML = modalBody;
        setupRadioButtons();

        let footerHTML =
          '<button class="btn btn-cancel" onclick="closeModal()"><i class="fas fa-times"></i> ปิด</button>';

        if (project.status === "pending" || project.status === "revision") {
          footerHTML +=
            '<button class="btn btn-success" onclick="submitEvaluation()"><i class="fas fa-paper-plane"></i> บันทึกผลการประเมิน</button>';
        }

        if (phase === "final" && project.status === "awaiting_signature") {
          const mySignature = project.committee.find((m) => !m.signed);
          if (mySignature) {
            footerHTML +=
              '<button class="btn btn-success" onclick="signDocument()"><i class="fas fa-signature"></i> ลงนามรับรอง</button>';
          }
        }

        document.getElementById("modalFooter").innerHTML = footerHTML;
        modal.style.display = "block";
      }

      function setupRadioButtons() {
        const radioOptions = document.querySelectorAll(".radio-option");
        radioOptions.forEach((option) => {
          option.addEventListener("click", function () {
            radioOptions.forEach((opt) => opt.classList.remove("selected"));
            this.classList.add("selected");
            this.querySelector('input[type="radio"]').checked = true;
          });
        });
      }

      function closeModal() {
        document.getElementById("projectModal").style.display = "none";
        currentProject = null;
      }

      function submitEvaluation() {
        const notes = document.getElementById("evaluationNotes").value;
        const selectedEval = document.querySelector(
          'input[name="evaluation"]:checked'
        );

        if (!selectedEval) {
          alert("กรุณาเลือกผลการประเมิน");
          return;
        }

        const evalValue = selectedEval.value;

        if (
          (evalValue === "revision" || evalValue === "re_exam") &&
          !notes.trim()
        ) {
          alert("กรุณาระบุความเห็นและข้อเสนอแนะสำหรับการแก้ไข");
          return;
        }

        if (confirm("คุณต้องการบันทึกผลการประเมินนี้ใช่หรือไม่?")) {
          const project = projectsData[currentProject.phase].find(
            (p) => p.id === currentProject.id
          );
          project.evaluationResult = evalValue;
          project.evaluationNotes = notes;

          if (evalValue === "passed") {
            if (currentProject.phase === "final") {
              project.status = "awaiting_signature";
            } else {
              project.status = "passed";
            }
          } else if (evalValue === "revision" || evalValue === "re_exam") {
            project.status = "revision";
          } else if (evalValue === "failed") {
            project.status = "failed";
          }

          alert("บันทึกผลการประเมินเรียบร้อยแล้ว");
          closeModal();
          renderProjects(currentProject.phase, currentStatusFilter);
        }
      }

      function signDocument() {
        if (confirm("คุณต้องการลงนามรับรองผลการสอบโครงงานนี้ใช่หรือไม่?")) {
          const project = projectsData[currentProject.phase].find(
            (p) => p.id === currentProject.id
          );

          const mySignature = project.committee.find((m) => !m.signed);
          if (mySignature) {
            mySignature.signed = true;
          }

          const allSigned = project.committee.every((m) => m.signed);
          if (allSigned) {
            project.status = "passed";
            alert(
              "ลงนามเรียบร้อยแล้ว! กรรมการทุกท่านได้ลงนามครบถ้วนแล้ว โครงงานเสร็จสมบูรณ์"
            );
          } else {
            alert("ลงนามเรียบร้อยแล้ว! รอกรรมการท่านอื่นลงนาม");
          }

          closeModal();
          renderProjects(currentProject.phase, currentStatusFilter);
        }
      }

      window.onclick = function (event) {
        const modal = document.getElementById("projectModal");
        if (event.target === modal) {
          closeModal();
        }
      };

      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
